<!-- Navbar (Header) Starts -->
<nav class="navbar navbar-expand-lg navbar-light bg-faded">
    <div class="container-fluid">
        <div class="navbar-header d-lg-none" *ngIf="role == 'Clinical' || role == 'Lab' || role == 'User'"> <!--*ngIf="role != 'Clinical' && role != 'Lab'"-->
            <button type="button" class="navbar-toggle d-lg-none float-left" data-toggle="collapse" (click)="toggleSidebar()">
                <span class="sr-only">{{'navbar.Toggle navigation' | translate }}</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>
        <div class="navbar-header" *ngIf="role != 'Clinical' && role != 'Lab' && role != 'User' && role!='Admin'">
            <button type="button" class="navbar-toggle d-lg-none float-left" data-toggle="collapse" (click)="toggleSidebar()">
                <span class="sr-only">{{'navbar.Toggle navigation' | translate }}</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>
        <div class="navbar-header d-none d-lg-block" *ngIf="role == 'Clinical' || role == 'Lab' || role == 'User' || role == 'Admin'" [ngClass]="{'pl-0': role=='Clinical' || role=='Lab' || role == 'User'|| role == 'Admin'}">
          <a [routerLink]="redirectUrl" class="logo-text float-left">
              <div class="logo-img">
                  <img src="assets/img/logo-Dx29.png" style="height: 40px;" />
              </div>
          </a>
          <div class="d-none d-lg-flex" *ngIf="role == 'Clinical' || role == 'Lab'">
            <img src="assets/img/indice.png" style="margin-left: 10px;"/>
            <li class="mr-2 active nav-link" *ngIf="actualUrl!='/clinical/dashboard/home'">
              <a  [routerLink]="redirectUrl">
                <h3 style="margin-bottom: 0;">{{'diagnosis.BackCases' | translate }}</h3>
              </a>
            </li>
            <li class="mr-2 active nav-link disabled" *ngIf="actualUrl=='/clinical/dashboard/home'">
              <a>
                <h3 style="margin-bottom: 0;">{{'diagnosis.Cases' | translate }}</h3>
              </a>
            </li>
          </div>
          <div class="d-none d-lg-flex" *ngIf="role == 'User'">
            <img src="assets/img/indice.png" style="margin-left: 10px;"/>
            <li class="mr-2 active nav-link" *ngIf="actualUrl!='/patient/dashboard/nodiagnosis' && actualUrl!='/patient/dashboard/withdiagnosis'">
              <a  [routerLink]="redirectUrl">
                <h3 style="margin-bottom: 0;">{{'dashboardpatient.BackMydata' | translate }}</h3>
              </a>
            </li>
            <li class="mr-2 active nav-link disabled" *ngIf="actualUrl=='/patient/dashboard/nodiagnosis' || actualUrl=='/patient/dashboard/withdiagnosis'">
              <a>
                <h3 style="margin-bottom: 0;">{{'dashboardpatient.My data' | translate }}</h3>
              </a>
            </li>
          </div>
          <div class="d-none d-lg-flex" *ngIf="role == 'Admin'">
            <img src="assets/img/indice.png" style="margin-left: 10px;"/>
            <li class="mr-2 active nav-link" *ngIf="actualUrl!='/admin/dashboard/admingtp'">
              <a  [routerLink]="redirectUrl">
                <h3 style="margin-bottom: 0;">{{'adminGTP.BackGTPData' | translate }}</h3>
              </a>
            </li>
            <li class="mr-2 active nav-link disabled" *ngIf="actualUrl=='/admin/dashboard/admingtp'">
              <a>
                <h3 style="margin-bottom: 0;">{{'adminGTP.GTP data' | translate }}</h3>
              </a>
            </li>
          </div>
        </div>
        <ngb-alert *ngIf="currentLang=='es'" type="light" class="mb-0 alert-yellow" style="inline-flex" [dismissible]="false">
          <span class="font-alert">{{'InfoSystem.Spanishtranslations' | translate }}</span>
        </ngb-alert>
        <div class="navbar-container" style="padding-left: 0px;">
            <div class="navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav">
                    <li class="nav-item mr-2">
                        <a href="javascript:;" class="nav-link" id="buttonShareTo" (click)="shareApp(shareTo)" *ngIf="role!='Admin'">
                            <i class="icon-share font-medium-3 blue-grey darken-4"></i>
                            <p class="d-none">Share</p>
                        </a>
                    </li>
                    <li class="nav-item mr-2" *ngIf="!isApp">
                        <a href="javascript:;" class="nav-link" id="navbar-fullscreen" appToggleFullscreen (click)="ToggleClass()">
                            <i class="{{toggleClass}} + ' ' + font-medium-3 blue-grey darken-4"></i>
                            <p class="d-none">{{'navbar.fullscreen' | translate }}</p>
                        </a>
                    </li>
                    <li class="nav-item mr-2" ngbDropdown display="dynamic" [placement]="placement" *ngIf="role == 'Clinical' || role == 'Lab'">
                        <a class="nav-link position-relative" id="dropdownBasic1" ngbDropdownToggle>
                            <i class="ft-help-circle font-medium-3 blue-grey darken-4"></i>
                            <p class="d-none">Help</p>
                        </a>
                        <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
                            <a class="dropdown-item py-1" routerLink="/pages/support">
                                <i class="ft-mail mr-2"></i>
                                <span>{{'support.support' | translate }}</span>
                            </a>
                            <div class="dropdown-divider" *ngIf="role == 'Clinical' || role == 'Lab'"></div>
                            <a class="dropdown-item" routerLink="/clinical/about" *ngIf="role == 'Clinical' || role == 'Lab'">
                                <i class="ft-book mr-2"></i>
                                <span>{{'about.title' | translate }}</span>
                            </a>
                        </div>
                    </li>
                    <li class="nav-item mr-2" *ngIf="role == 'User'">
                        <a class="nav-link position-relative notification-sidebar-toggle" routerLink="/pages/support">
                            <i class="ft-mail font-medium-3 blue-grey darken-4"></i>
                            <p class="d-none">{{'support.support' | translate }}</p>
                        </a>
                    </li>
                    <li class="nav-item" ngbDropdown display="dynamic" [placement]="placement">
                        <a class="nav-link position-relative" id="dropdownBasic3" ngbDropdownToggle>
                            <i class="ft-user font-medium-3 blue-grey darken-4"></i>
                            <p class="d-none">{{'navbar.User Settings' | translate }}</p>
                        </a>
                        <div ngbDropdownMenu aria-labelledby="dropdownBasic3">
                            <a class="dropdown-item py-1" routerLink="/pages/profile">
                                <i class="ft-edit mr-2"></i>
                                <span>{{'navbar.My Profile' | translate }}</span>
                            </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="javascript:;" (click)="logout()">
                                <i class="ft-power mr-2"></i>
                                <span>{{'navbar.Logout' | translate }}</span>
                            </a>
                            <div *ngIf="isApp && isAndroid" class="dropdown-divider"></div>
                            <a *ngIf="isApp && isAndroid" class="dropdown-item" href="javascript:;" (click)="exit()">
                                <i class="ft-log-out mr-2"></i>
                                <span>{{'navbar.Exit' | translate }}</span>
                            </a>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</nav>
<!-- Navbar (Header) Ends -->

<ng-template #shareTo let-c="close" let-d="dismiss" appendTo="body">
		<div class="modal-header" id="idHeader">
			<h4>{{'dashboardpatient.Share' | translate }} <span class="font-small-2 d-block mt-1">{{'patdiagdashboard.msgshare' | translate }}</span></h4>

			<button type="button" class="close" aria-label="Close" (click)="c('Close click')">
				<span aria-hidden="true">&times;</span>
			</button>
		</div>
    <div *ngIf="loading" class="center-elements mt-3 mb-3">
      <i class="fa fa-spinner fa-spin fa-3x fa-fw pink"></i>
    </div>

      <form #f="ngForm">
        <div *ngIf="!loading">
          <div class="mt-2">
            <div class="col-md-12 mt-4">
              <div class="input-group">
                  <span class="input-group-text">
                      <i class="ft-user-plus"></i>
                  </span>
                  <select id="roleShare" name="roleShare" class="form-control" ngModel required [(ngModel)]="roleShare">
                    <option value="User">{{'dashboardpatient.Send invite to use Dx29' | translate }}</option>
                    <option value="Clinical" [disabled]="patients.length==0">{{'dashboardpatient.Share your data anonymously' | translate }} <span *ngIf="patients.length==0">({{'permissions.can not share with clinicians' | translate }}) </span></option>
                  </select>
              </div>
            </div>
            <div class="col-md-12">
              <div class="input-group">
                  <span class="input-group-text">
                      <i class="ft-mail"></i>
                  </span>
                  <input type="email" class="form-control" name="emailt" id="emailt" placeholder="{{'generics.Email' | translate }}" ngModel [(ngModel)]="email" required emailt #emailt="ngModel">
              </div>
              <small class="form-text text-muted danger" *ngIf="!emailt.valid && (emailt.dirty || emailt.touched)">{{'generics.entervalidemail' | translate }}</small>
            </div>
            <div class="col-md-12 mt-2" *ngIf="roleShare=='Clinical' && patients.length>0 && role !='User'">
              <div class="form-group">
                <label>{{'diagnosis.Select case' | translate }}</label>
               <select id="selectedPatient" id="selectedPatient" name="selectedPatientj" class="form-control"  [(ngModel)]="selectedPatient.sub" (ngModelChange)="onChangePatient(selectedPatient)">
                  <option *ngFor="let onepatient of patients" [ngValue]="onepatient.sub"><span *ngIf="onepatient.alias">{{onepatient.alias}}</span><span *ngIf="!onepatient.alias">{{onepatient.patientName}}</span></option>
                </select>
              </div>
            </div>
            <div class="form-group col-md-12" *ngIf="roleShare=='Clinical' && isMine">

              <p *ngFor="let onepatient of patients">
                <span *ngIf="onepatient.sub == selectedPatient.sub">
                  <h5>Items to share</h5>
                  <mat-checkbox class="example-margin" [checked]="true" [disabled]="true">{{'permissions.List of symptoms' | translate }}</mat-checkbox>
                  <mat-checkbox class="example-margin d-block" [checked]="true" [disabled]="true">{{'permissions.Genetics information if available' | translate }}</mat-checkbox>
                  <h5 class="mt-2" for="Permissions">{{'permissions.Permissions' | translate }}</h5>
                  <mat-checkbox class="example-margin" [disabled]="!onepatient.ismine" name="shareEmr" ngModel  [(ngModel)]="permissions.shareEmr" #shareEmr="ngModel" id="shareEmr">{{'permissions.Share EMR' | translate }}</mat-checkbox>
                  <mat-checkbox class="ml-2 example-margin" [disabled]="!onepatient.ismine" name="askFirst" ngModel (change)="setPermissionsForm('askFirst')" [(ngModel)]="permissions.askFirst" #askFirst="ngModel" id="askFirst">{{'permissions.Ask before sharing' | translate }}</mat-checkbox>
                  <mat-checkbox class="ml-2 example-margin" [disabled]="!onepatient.ismine" name="shareWithAll" ngModel (change)="setPermissionsForm('shareWithAll')" [(ngModel)]="permissions.shareWithAll" #shareWithAll="ngModel" id="shareWithAll">{{'permissions.Sharing with third parties' | translate }}</mat-checkbox>
                  <span *ngIf="!onepatient.ismine" class="text-muted d-block">{{'permissions.message to deny permission' | translate }}</span>
                </span>
              </p>

            </div>
        </div>
        <div class="col-md-12" *ngIf="roleShare=='Clinical'">
          <div *ngIf="!isMine && permissions.askFirst" class="col-md-12">
            {{'permissions.normal request with form' | translate }}
          </div>
          <div *ngIf="!isMine && !permissions.askFirst && !permissions.shareWithAll" class="col-md-12">
            {{'permissions.Make full request' | translate }}
          </div>

          <div class="col-md-12">
            <div class="form-group">
              <label for="message">{{'support.Message' | translate }}</label>
              <textarea name="message" id="textarea1" (ngModelChange)="resizeTextArea()" class="autoajustable form-control" [(ngModel)]="message"></textarea>
            </div>
          </div>
        </div>

        <div class="col-md-12">
          <div class="center-elements" *ngIf="!sending">
            <div *ngIf="f.valid;then formValid else formError"></div>
            <ng-template #formValid>
              <button class="btn btn-primary btn-outline-primary" (click)="inviteShare()"> <span *ngIf="roleShare=='User'">{{'dashboardpatient.Invite' | translate }}</span><span *ngIf="roleShare!='User'">{{'dashboardpatient.Share' | translate }}</span></button>
            </ng-template>
            <ng-template #formError>
              <button class="btn btn-primary btn-outline-primary" type="button" disabled="true" (click)="submitInvalidForm()"> <label *ngIf="roleShare=='User'">{{'dashboardpatient.Invite' | translate }}</label><label *ngIf="roleShare!='User'">{{'dashboardpatient.Share' | translate }}</label></button>
            </ng-template>
          </div>
          <div class="center-elements" *ngIf="sending">
            <p class="centerSpinner"><i class="fa fa-spinner fa-spin fa-3x fa-fw pink"></i></p>
          </div>
        </div>
        </div>
      </form>

      <div class="col-md-12 mt-2" *ngIf="listOfSharingAccounts.length>0 && !sending && !loading">
        <div class="col-md-12">
          <h5>{{'dashboardpatient.Sharing with' | translate }}</h5>
        </div>
        <div class="table-responsive">
          <table class="col-md-12 table" *ngIf="!revonking">
            <thead>
              <tr>
                <th *ngIf="role!='User'" style="width:20%">{{'diagnosis.Case' | translate }}</th>
                <th style="width:20%">{{'generics.Email' | translate }}</th>
                <th style="width:10%">Role</th>
                <th style="width:10%">{{'generics.Sharing date' | translate }}</th>
                <th style="width:20%">{{'permissions.Permissions' | translate }}</th>
                <th style="width:20%">{{'generics.Status' | translate }}</th>
                <th style="width:10%">{{'generics.Options' | translate }}</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let account of listOfSharingAccounts ; let i = index">
                <td *ngIf="role!='User'">{{account.patientName}}</td>
                <td>{{account.email}}</td>
                <td>{{account.role}}</td>
                <td>{{account.date | date}}</td>
                <td>
                  <p *ngIf="account.permissions && account.role != 'User'">
                    <span *ngIf="account.permissions.shareEmr" class="d-block">{{'permissions.Share EMR' | translate }} </span>
                    <span *ngIf="account.permissions.askFirst" class="d-block">{{'permissions.Ask before sharing' | translate }} </span>
                    <span *ngIf="account.permissions.shareWithAll" class="d-block">{{'permissions.Sharing with third parties' | translate }} </span>
                    <span class="d-block"><i class="fa fa-edit" style="cursor: pointer;" title="Importance" (click)="changePermissions(i, contentChangePermissions)"></i></span>
                  </p>
                  <p *ngIf="!account.permissions || account.role == 'User'">
                    <span> - </span>
                  </p>
                </td>
                <td>
                  <span *ngIf="account._id==null && account.role == 'User'">Invited</span>
                  <!--<span *ngIf="account._id==null && account.role != 'User' && account.state == 'Pending'">{{'generics.Pending' | translate }}</span>-->
                  <span *ngIf="account.role != 'User' && account.state == 'Pending'">{{'generics.Pending' | translate }}</span>
                  <span *ngIf="(account._id==null && account.role != 'User' && account.state == '') || account._id != null && account.state != 'Pending' && account.state != 'Rejected'">{{'generics.Shared' | translate }}</span>
                  <span *ngIf="account.state == 'Rejected'">{{'generics.Rejected' | translate }}</span>
                </td>
                <td>
                  <span>
                    <a *ngIf="(account._id==null && account.state == 'Pending') && account.state != 'Rejected'" class="primary" data-original-title="" title="{{'generics.Resend' | translate }}" (click)="resend(i)">
                      <i class="fa fa-repeat"></i>
                    </a>
                    <a *ngIf="(account._id==null || account.state == 'Pending') && account.state != 'Rejected' && myUserId !=account.invitedby" class="primary" data-original-title="" title="{{'generics.Resend' | translate }}" (click)="acceptReject(i, 'true')">
                      {{'generics.Accept' | translate }}
                    </a>
                    <a *ngIf="(account._id==null || account.state == 'Pending') && account.state != 'Rejected' && myUserId !=account.invitedby" class="danger" data-original-title="" title="{{'generics.Resend' | translate }}" (click)="acceptReject(i, 'false')">
                      {{'generics.Reject' | translate }}
                    </a>
                  </span>
                  <span class="pull-right">
                    <a class="danger" data-original-title="" title="{{'generics.Delete' | translate }}" (click)="confirmRevokePermission(i)">
                      <i class="ft-x"></i>
                    </a>
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
          <p class="centerSpinner" *ngIf="revonking"><i class="fa fa-spinner fa-spin fa-3x fa-fw pink"></i></p>
        </div>
      </div>
</ng-template>

<ng-template #contentChangePermissions let-c="close" let-d="dismiss" appendTo="body">
		<div class="modal-header" id="idHeader">
				<h4 class="modal-title">{{'permissions.Permissions' | translate }}</h4>
		</div>
		<div class="modal-body">
			<div class="col-md-6">
        <div class="form-group">
					<p>
						<mat-checkbox class="example-margin" name="shareEmr" ngModel  [(ngModel)]="shareWithObject.permissions.shareEmr" #shareEmr="ngModel" id="shareEmr" (change)="setPermissions('shareEmr')">{{'permissions.Share EMR' | translate }} </mat-checkbox>
					</p>
					<p>
						<mat-checkbox class="example-margin" name="askFirst" ngModel  [(ngModel)]="shareWithObject.permissions.askFirst" #askFirst="ngModel" id="askFirst" (change)="setPermissions('askFirst')">{{'permissions.Ask before sharing' | translate }} </mat-checkbox>
					</p>
					<p>
						<mat-checkbox class="example-margin" name="shareWithAll" ngModel  [(ngModel)]="shareWithObject.permissions.shareWithAll" #shareWithAll="ngModel" id="shareWithAll" (change)="setPermissions('shareWithAll')">{{'permissions.Sharing with third parties' | translate }} </mat-checkbox>
					</p>
				</div>
			</div>
		</div>
		<div class="modal-footer">
			<div class="form-actions center" *ngIf="!sending">
					<button type="button" class="btn btn-secondary btn-raised" (click)="closeContentChangePermissions(shareTo)">{{'generics.Close' | translate }}</button>
			</div>
		</div>
</ng-template>
